#!/usr/bin/python
import sys, os
from optparse import *
sys.path.append(os.path.join(os.path.dirname(__file__), '../..'))
from broomstick_simulation import runBroomstickSimulation
import PyFrensie.Utility as Utility
import PyFrensie.MonteCarlo as MonteCarlo

if __name__ == "__main__":
    
    # Parse the command line options
    parser = OptionParser()
    parser.add_option("--threads", type="int", dest="threads", default=1,
                      help="the number of threads to use")
    parser.add_option("--db_path", type="string", dest="db_path",
                      help="the database name (with extension)")
    parser.add_option("--sim_name", type="string", dest="sim_name", default="sphere",
                      help="the simulation name")
    parser.add_option("--log_file", type="string", dest="log_file",
                      help="the file that will be used for logging")
    parser.add_option("--num_particles", type="float", dest="num_particles", default=1e3,
                      help="the number of particles to run")
    options,args = parser.parse_args()

    if options.db_path is None:
        print "The database path must be specified!"
        sys.exit(1)

    energy_bins = [0.001, 0.001998, 0.002996, 0.003994, 0.004992, 0.00599, 
                   0.006988, 0.007986, 0.008984, 0.009982, 0.01098, 0.011978, 
                   0.012976, 0.013974, 0.014972, 0.01597, 0.016968, 0.017966, 
                   0.018964, 0.019962, 0.02096, 0.021958, 0.022956, 0.023954, 
                   0.024952, 0.02595, 0.026948, 0.027946, 0.028944, 0.029942, 
                   0.03094, 0.031938, 0.032936, 0.033934, 0.034932, 0.03593, 
                   0.036928, 0.037926, 0.038924, 0.039922, 0.04092, 0.041918, 
                   0.042916, 0.043914, 0.044912, 0.04591, 0.046908, 0.047906, 
                   0.048904, 0.049902, 0.0509, 0.051898, 0.052896, 0.053894, 
                   0.054892, 0.05589, 0.056888, 0.057886, 0.058884, 0.059882, 
                   0.06088, 0.061878, 0.062876, 0.063874, 0.064872, 0.06587, 
                   0.066868, 0.067866, 0.068864, 0.069862, 0.07086, 0.071858, 
                   0.0730385, 0.0730395, 0.0752495, 0.0752505, 0.076848, 0.077846, 
                   0.078844, 0.079842, 0.08084, 0.081838, 0.082836, 0.0847402, 
                   0.0847412, 0.0852349, 0.0852359, 0.0856948, 0.0856958, 0.0858005, 
                   0.0858015, 0.08583, 0.0875335, 0.0875345, 0.0876552, 0.0876562, 
                   0.0878543, 0.0878553, 0.087877, 0.087878, 0.0881786, 0.0881796, 
                   0.0882019, 0.0882029, 0.0882607, 0.0882617, 0.0882635, 0.0882645, 
                   0.0882825, 0.0882835, 0.0882842, 0.0882852, 0.088824, 0.089822, 
                   0.09082, 0.091818, 0.092816, 0.093814, 0.094812, 0.09581, 
                   0.096808, 0.097806, 0.098804, 0.099802, 0.1008, 0.101798, 
                   0.102796, 0.103794, 0.104792, 0.10579, 0.106788, 0.107786, 
                   0.108784, 0.109782, 0.11078, 0.111778, 0.112776, 0.113774, 
                   0.114772, 0.11577, 0.116768, 0.117766, 0.118764, 0.119762, 
                   0.12076, 0.121758, 0.122756, 0.123754, 0.124752, 0.12575, 
                   0.126748, 0.127746, 0.128744, 0.129742, 0.13074, 0.131738, 
                   0.132736, 0.133734, 0.134732, 0.13573, 0.136728, 0.137726, 
                   0.138724, 0.139722, 0.14072, 0.141718, 0.142716, 0.143714, 
                   0.144712, 0.14571, 0.146708, 0.147706, 0.148704, 0.149702, 
                   0.1507, 0.151698, 0.152696, 0.153694, 0.154692, 0.15569, 
                   0.156688, 0.157686, 0.158684, 0.159682, 0.16068, 0.161678, 
                   0.162676, 0.163674, 0.164672, 0.16567, 0.166668, 0.167666, 
                   0.168664, 0.169662, 0.17066, 0.171658, 0.172656, 0.173654, 
                   0.174652, 0.17565, 0.176648, 0.177646, 0.178644, 0.179642, 
                   0.18064, 0.181638, 0.182636, 0.183634, 0.184632, 0.18563, 
                   0.186628, 0.187626, 0.188624, 0.189622, 0.19062, 0.191618, 
                   0.192616, 0.193614, 0.194612, 0.19561, 0.196608, 0.197606, 
                   0.198604, 0.199602, 0.2006, 0.201598, 0.202596, 0.203594, 
                   0.204592, 0.20559, 0.206588, 0.207586, 0.208584, 0.209582, 
                   0.21058, 0.211578, 0.212576, 0.213574, 0.214572, 0.21557, 
                   0.216568, 0.217566, 0.218564, 0.219562, 0.22056, 0.221558, 
                   0.222556, 0.223554, 0.224552, 0.22555, 0.226548, 0.227546, 
                   0.228544, 0.229542, 0.23054, 0.231538, 0.232536, 0.233534, 
                   0.234532, 0.23553, 0.236528, 0.237526, 0.238524, 0.239522, 
                   0.24052, 0.241518, 0.242516, 0.243514, 0.244512, 0.24551, 
                   0.246508, 0.247506, 0.248504, 0.249502, 0.2505, 0.251498, 
                   0.252496, 0.253494, 0.254492, 0.25549, 0.256488, 0.257486, 
                   0.258484, 0.259482, 0.26048, 0.261478, 0.262476, 0.263474, 
                   0.264472, 0.26547, 0.266468, 0.267466, 0.268464, 0.269462, 
                   0.27046, 0.271458, 0.272456, 0.273454, 0.274452, 0.27545, 
                   0.276448, 0.277446, 0.278444, 0.279442, 0.28044, 0.281438, 
                   0.282436, 0.283434, 0.284432, 0.28543, 0.286428, 0.287426, 
                   0.288424, 0.289422, 0.29042, 0.291418, 0.292416, 0.293414, 
                   0.294412, 0.29541, 0.296408, 0.297406, 0.298404, 0.299402, 
                   0.3004, 0.301398, 0.302396, 0.303394, 0.304392, 0.30539, 
                   0.306388, 0.307386, 0.308384, 0.309382, 0.31038, 0.311378, 
                   0.312376, 0.313374, 0.314372, 0.31537, 0.316368, 0.317366, 
                   0.318364, 0.319362, 0.32036, 0.321358, 0.322356, 0.323354, 
                   0.324352, 0.32535, 0.326348, 0.327346, 0.328344, 0.329342, 
                   0.33034, 0.331338, 0.332336, 0.333334, 0.334332, 0.33533, 
                   0.336328, 0.337326, 0.338324, 0.339322, 0.34032, 0.341318, 
                   0.342316, 0.343314, 0.344312, 0.34531, 0.346308, 0.347306, 
                   0.348304, 0.349302, 0.3503, 0.351298, 0.352296, 0.353294, 
                   0.354292, 0.35529, 0.356288, 0.357286, 0.358284, 0.359282, 
                   0.36028, 0.361278, 0.362276, 0.363274, 0.364272, 0.36527, 
                   0.366268, 0.367266, 0.368264, 0.369262, 0.37026, 0.371258, 
                   0.372256, 0.373254, 0.374252, 0.37525, 0.376248, 0.377246, 
                   0.378244, 0.379242, 0.38024, 0.381238, 0.382236, 0.383234, 
                   0.384232, 0.38523, 0.386228, 0.387226, 0.388224, 0.389222, 
                   0.39022, 0.391218, 0.392216, 0.393214, 0.394212, 0.39521, 
                   0.396208, 0.397206, 0.398204, 0.399202, 0.4002, 0.401198, 
                   0.402196, 0.403194, 0.404192, 0.40519, 0.406188, 0.407186, 
                   0.408184, 0.409182, 0.41018, 0.411178, 0.412176, 0.413174, 
                   0.414172, 0.41517, 0.416168, 0.417166, 0.418164, 0.419162, 
                   0.42016, 0.421158, 0.422156, 0.423154, 0.424152, 0.42515, 
                   0.426148, 0.427146, 0.428144, 0.429142, 0.43014, 0.431138, 
                   0.432136, 0.433134, 0.434132, 0.43513, 0.436128, 0.437126, 
                   0.438124, 0.439122, 0.44012, 0.441118, 0.442116, 0.443114, 
                   0.444112, 0.44511, 0.446108, 0.447106, 0.448104, 0.449102, 
                   0.4501, 0.451098, 0.452096, 0.453094, 0.454092, 0.45509, 
                   0.456088, 0.457086, 0.458084, 0.459082, 0.46008, 0.461078, 
                   0.462076, 0.463074, 0.464072, 0.46507, 0.466068, 0.467066, 
                   0.468064, 0.469062, 0.47006, 0.471058, 0.472056, 0.473054, 
                   0.474052, 0.47505, 0.476048, 0.477046, 0.478044, 0.479042, 
                   0.48004, 0.481038, 0.482036, 0.483034, 0.484032, 0.48503, 
                   0.486028, 0.487026, 0.488024, 0.489022, 0.49002, 0.491018, 
                   0.492016, 0.493014, 0.494012, 0.49501, 0.496008, 0.497006, 
                   0.498004, 0.499002, 0.5]

    # Run the simulation
    runBroomstickSimulation( options.sim_name,
                             options.db_path,
                             options.num_particles,
                             MonteCarlo.IMPULSE_INCOHERENT_MODEL,
                             0.5,
                             energy_bins,
                             options.threads,
                             options.log_file )
    
    
